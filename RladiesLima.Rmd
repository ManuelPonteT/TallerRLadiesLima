---
title: "R LadiesLima Analizar datos electorales con R"
author: "Marylía Cruz"
date: "29/08/2020"
output:
  html_document:
    df_print: paged
---



**<span style="color:blue">ÍNDICE</span>**

1. [Descargar las bases de datos](#id1)
2. [Cambiar de directorio de trabajo](#id2)
3. [Abrir la base de datos](#id3)
4. [Manejo de las bases de datos](#id4)
5. [PREGUNTA 1: ¿Se ha incrementado la participación política de las mujeres en las elecciones provinciales?](#id5)
6. [PREGUNTA 2: ¿A qué cargos postulan más las mujeres en elecciones provinciales?](#id6)
7. [PREGUNTA 3: ¿En qué provincias postulan más las mujeres a las alcadías provinciales?"](#id7)



**<span style="color:blue">DESARROLLO</span>**

**[Descargar las bases de datos y los paquetes a utilizar ](#mark)<a name="id1"></a>**

Descargar las bases de candidatos de las elecciones municipales provinciales del 2002, 2006, 2010, 2014 y 2018 del siguiente link: https://infogob.jne.gob.pe/BaseDatos 

```{r}
#install.packages("dplyr")
library(dplyr) # para el gráfico estático

#install.packages("ggplot2")
library(ggplot2) # para el gráfico estático

#install.packages("gganimate")
library(gganimate) # para el gráfico animado

#install.packages("gifski")
library(gifski)  # para el gráfico animado

#install.packages("av")
library(av) # para el gráfico animado
```

**[Cambiar de directorio de trabajo](#mark)<a name="id2"></a>**

Una vez descargadas las bases de datos, crea una carpeta en tu ordenador donde se ubiquen todas las bases de datos a utilizar. En mi caso, cree la carpeta TallerRLadiesLima.
La ruta es mi carpeta es "~/Documentos/GitHub/TallerRLadiesLima"
Si no sabes la ruta de tu carpeta, también puede ir al menú : SESION-SET WORKING DIRECTORY-CHOOSE DIRECTORY

```{r}
setwd("~/Documentos/GitHub/TallerRLadiesLima")
```

**[Abrir la base de datos](#mark)<a name="id3"></a>**

```{r}
library(readxl) #install.packages("readxl")
Candidatos2002 <- read_excel("ERM2002_Candidatos_Provincial.xlsx")
Candidatos2006 <- read_excel("ERM2006_Candidatos_Provincial.xlsx")
Candidatos2010 <- read_excel("ERM2010_Candidatos_Provincial.xlsx")
Candidatos2014 <- read_excel("ERM2014_Candidatos_Provincial.xlsx")
Candidatos2018 <- read_excel("ERM2018_Candidatos_Provincial.xlsx")

Ubigeo <- read_excel("Ubigeo.xlsx")
```

**[Manejo de las bases de datos](#mark)<a name="id4"></a>**

El comando "names" muestra el nombre de las variables.

```{r}
names(Candidatos2002)
names(Candidatos2006)
names(Candidatos2010)
names(Candidatos2014)
names(Candidatos2018)
```

Creo una nueva variable "anio" que indica el año de elección en cada base de datos

```{r}
Candidatos2002$anio=2002
Candidatos2006$anio=2006
Candidatos2010$anio=2010
Candidatos2014$anio=2014
Candidatos2018$anio=2018
```



Junto todas las bases de datos en una sola base de datos. 

```{r}
lista=list(Candidatos2002,Candidatos2006,Candidatos2010,Candidatos2014,Candidatos2018)
#list = crea una lista de elementos
# rbind= junta filas de distintas bases de datos
# do.call =  repite una acción del código
# as.data.frame =  como base de datos
Candidatos=as.data.frame(do.call(rbind,lista))
```


Utilizar el comando "merge" para juntar las bases de datos de los candidatos de las elecciones provinciales y la de ubigeo. 


```{r}
Candidatos=merge(Candidatos,Ubigeo,by.x="Provincia",by.y="Provincia")
names(Candidatos)
```

Definir las variables según el tipo

```{r}
str(Candidatos)
Candidatos$Sexo=as.factor(Candidatos$Sexo)
Candidatos$Cargo=as.factor(Candidatos$Cargo)
```



**[PREGUNTA 1: ¿Se ha incrementado la participación política de las mujeres en las elecciones provinciales?](#mark)<a name="id5"></a>**


##### CREANDO TABLAS

El comando "table" siver para crear tablas de frecuencias.
```{r}
tablaresumen=table(Candidatos$Sexo,Candidatos$anio)
```


```{r}
# El comando "prop.table" siver para crear tablas de proporciones
# El número 2  indica que se desea porcentajes por columnas.
# Se coloca *100 para multiplicar por 100 las proporciones de 0 a 1.
prop.table(table(Candidatos$Sexo,Candidatos$anio),2)*100
prop.table(table(Candidatos$Sexo,Candidatos$anio),2)
```


##### GRAFICO SENCILLO SIN GGPLOT2

```{r}
###El comando "barplot" se utiliza para realizar gráfico de barras  
barplot(prop.table(tablaresumen,2)*100,
        main = "Resultados de la encuesta",
        xlab = "Frecuencias relativas (%)",
        legend = T,
        width = 0.5, ylim = c(0, 2.5),
        horiz = T)
```


##### INSUMOS PARA GRÁFICO

```{r}
#tablaresumen=table(Candidatos$Sexo,Candidatos$anio)
as.data.frame(tablaresumen)
```


```{r}
#Uso el comando "aggregate" para resumir tablas y calcular la suma total de candidatos por años
tabla_general=aggregate(Freq ~ Var2, data = tablaresumen, sum)
```


```{r}
#Usar el comando "merge" para juntar la tabla anterior con la tabla resumen
Candidatos_tabla1=merge(tablaresumen,tabla_general,by=c("Var2"))
```


Calcular la proporción de la cantidad de mujeres y la cantidad total de candidatos
```{r}
Candidatos_tabla1$Proporcion=Candidatos_tabla1$Freq.x/Candidatos_tabla1$Freq.y
```

Se crea una lista de nombres nuevos para renombrar  Candidatos_tabla1.

```{r}
names(Candidatos_tabla1) <- c("anio", "Sexo","Frecuencia","Total_Candidatos","Proporcion")
```

Redefino el formato de la variable anio . Utilizo el comando "as.numeric" para definir como variable numérica a anio.

```{r}
Candidatos_tabla1$anio=as.numeric(Candidatos_tabla1$anio)
```


##### GRÁFICO ESTÁTICO

```{r}
grafico1estatico=ggplot(Candidatos_tabla1,aes(x=anio, y=Proporcion, group=Sexo,
                                              color=Sexo))+
  geom_line(size=3) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(x="Año de la elección",y="Porcentaje de Candidatos",title="Gráfico estático de candidaturas a nivel provincial") 

grafico1estatico+ scale_x_discrete(limits=c("2002","2006","2010","2014","2018"))

```



##### GRÁFICO ANIMADO

```{r}
grafico1dinamico=ggplot(Candidatos_tabla1,aes(x=anio, y=Proporcion, group=Sexo,
                                              color=Sexo))+
  geom_line(size=3) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(x="año de la elección",y="Porcentaje de Candidatos",title="Gráfico animado de candidaturas a nivel provincial" ) + 
  transition_reveal(anio)
```

```{r}
grafico1dinamico + scale_x_discrete(limits=c("2002","2006","2010","2014","2018"))
```

Guardar el gif
```{r}
anim_save("grafico1dinamico.gif")
```


**[PREGUNTA 2: ¿A qué cargos postulan más las mujeres en elecciones provinciales?](#mark)<a name="id6"></a>**


#####  INSUMOS PARA GRÁFICO

Uso el comando "table" para crear una tabla de frecuencia de sexo, anio y cargo.
```{r}
tabla=as.data.frame(table(Candidatos$Sexo,Candidatos$anio,Candidatos$Cargo))
tabla
```

El comando "aggregate" sirve crear una tabla para calcular cantidad total de candidatos y de cantidad total de candidatos a regidores a nivel provincial

```{r}
tabla_frecuencia=aggregate(Freq ~ Var2+Var3, data = tabla, sum)
tabla_frecuencia
```

Uso el comando "merge" para unir las dos tablas anteriores
```{r}
Candidatos_tabla2=merge(tabla,tabla_frecuencia,by=c("Var2","Var3"))
Candidatos_tabla2
```

Calculo la proporción de candidatos por sexo
```{r}
Candidatos_tabla2$Proporcion=Candidatos_tabla2$Freq.x/Candidatos_tabla2$Freq.y
```

Se crea una lista de nombres nuevos para renombrar  Candidatos_tabla2
```{r}
names(Candidatos_tabla2) <- c("anio", "Cargo","Sexo","Frecuencia","Total_Candidatos","Proporcion")
```

Redefino el formato de la variable anio . Utilizo el comando "as.numeric" para definir como variable numérica a anio.
```{r}
Candidatos_tabla2$anio=as.numeric(Candidatos_tabla2$anio)
```

#####  GRÁFICO ESTÁTICO
```{r}
grafico2estatico=ggplot(Candidatos_tabla2,aes(x=anio, y=Proporcion, group=Sexo,
                                              color=Sexo))+
  geom_line(size=3) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(x="Año de la elección",y="Porcentaje de Candidatos",title="Gráfico estático de candidatos según el cargo al que postula") + 
  facet_wrap(~Cargo,ncol=2,strip.position = "top")
grafico2estatico+ scale_x_discrete(limits=c("2002","2006","2010","2014","2018"))
```

##### GRÁFICO ANIMADO
```{r}
grafico2dinamico=ggplot(Candidatos_tabla2,aes(x=anio, y=Proporcion, group=Sexo,
                                              color=Sexo))+
  geom_line(size=3) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  labs(x="Año de la elección",y="Porcentaje de Candidatos",title="Gráfico animado de candidatos según el cargo al que postula") + 
  facet_wrap(~Cargo,ncol=2,strip.position = "top")+
  transition_reveal(anio)
grafico2dinamico+ scale_x_discrete(limits=c("2002","2006","2010","2014","2018"))
```


Guardar el gif
```{r}
anim_save("grafico2dinamico.gif")
```






**[PREGUNTA 3: ¿En qué provincias postulan más las mujeres a las alcadías provinciales?](#mark)<a name="id7"></a>**